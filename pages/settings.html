<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pengaturan - Sistem Pengadaan</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="app-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ“‹ SIPBJ</div>
        <div class="sidebar-subtitle">Sistem Informasi Pengadaan<br>Barang & Jasa</div>
      </div>
      <nav class="sidebar-menu">
        <a href="../index.html" class="menu-item"><span class="menu-icon">ğŸ </span><span class="menu-text">Dashboard</span></a>
        <div class="menu-title">Pengadaan</div>
        <a href="projects.html" class="menu-item"><span class="menu-icon">ğŸ“</span><span class="menu-text">Daftar Paket</span></a>
        <div class="menu-title">Dokumen</div>
        <a href="hps.html" class="menu-item"><span class="menu-icon">ğŸ“Š</span><span class="menu-text">HPS</span></a>
        <a href="bast.html" class="menu-item"><span class="menu-icon">ğŸ¤</span><span class="menu-text">BAST</span></a>
        <a href="ba-bayar.html" class="menu-item"><span class="menu-icon">ğŸ’³</span><span class="menu-text">BA Pembayaran</span></a>
        <a href="kuitansi.html" class="menu-item"><span class="menu-icon">ğŸ§¾</span><span class="menu-text">Kuitansi</span></a>
        <div class="menu-title">Lainnya</div>
        <a href="settings.html" class="menu-item active"><span class="menu-icon">âš™ï¸</span><span class="menu-text">Pengaturan</span></a>
      </nav>
    </aside>
    <main class="main-content">
      <div class="breadcrumb"><a href="../index.html">Dashboard</a> / <span>Pengaturan</span></div>
      <div class="page-header">
        <div>
          <h1 class="page-title">âš™ï¸ Pengaturan Sistem</h1>
          <p class="page-subtitle">Konfigurasi aplikasi dan data institusi</p>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><h2 class="card-title">ğŸ”— Konfigurasi API</h2></div>
        <div class="card-body">
          <div id="apiAlert" class="alert hidden"></div>
          <div class="form-group">
            <label class="form-label">Status Koneksi</label>
            <div style="padding:12px;background:#f8f9fa;border-radius:6px;display:flex;align-items:center;gap:10px;">
              <span id="statusIndicator" style="width:12px;height:12px;border-radius:50%;background:#9e9e9e;"></span>
              <span id="statusText">Belum ditest</span>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Google Apps Script URL</label>
            <input type="url" id="apiUrl" class="form-control" placeholder="https://script.google.com/macros/s/.../exec">
          </div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="testConnection()">ğŸ” Test</button>
            <button class="btn btn-primary" onclick="saveApiUrl()">ğŸ’¾ Simpan</button>
            <button class="btn btn-danger" onclick="resetApiUrl()">ğŸ—‘ï¸ Reset</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><h2 class="card-title">ğŸ›ï¸ Data Institusi</h2></div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Satuan Kerja</label>
            <input type="text" id="instSatker" class="form-control" readonly style="background:#f8f9fa;">
          </div>
          <div class="form-group">
            <label class="form-label">Nama PPK</label>
            <input type="text" id="ppkNama" class="form-control" readonly style="background:#f8f9fa;">
          </div>
          <p class="form-hint">Edit file <code>js/institution.js</code> untuk mengubah data institusi</p>
        </div>
      </div>
    </main>
  </div>
  <script src="../js/config.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/institution.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('apiUrl').value = CONFIG.API_URL;
      document.getElementById('instSatker').value = INSTITUTION.satker;
      document.getElementById('ppkNama').value = INSTITUTION.ppinak.nama;
    });
    function testConnection() {
      var url = document.getElementById('apiUrl').value.trim();
      if (!url) { showAlert('error', 'Masukkan URL'); return; }
      CONFIG.setApiUrl(url);
      setStatus('warning', 'Testing...');
      API.get('getProjects').then(function(r) {
        if (r.success) { setStatus('success', 'Berhasil!'); showAlert('success', 'Koneksi OK'); }
        else { setStatus('error', 'Gagal'); showAlert('error', r.error); }
      });
    }
    function saveApiUrl() {
      var url = document.getElementById('apiUrl').value.trim();
      if (CONFIG.setApiUrl(url)) showAlert('success', 'Tersimpan!');
    }
    function resetApiUrl() {
      CONFIG.clearApiUrl();
      document.getElementById('apiUrl').value = CONFIG.DEFAULT_URL;
      showAlert('success', 'Reset');
    }
    function setStatus(type, text) {
      var colors = { success: '#4caf50', warning: '#ff9800', error: '#f44336' };
      document.getElementById('statusIndicator').style.background = colors[type];
      document.getElementById('statusText').textContent = text;
    }
    function showAlert(type, msg) {
      var el = document.getElementById('apiAlert');
      el.className = 'alert alert-' + type;
      el.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(function() { el.classList.add('hidden'); }, 3000);
    }
  </script>
</body>
</html>
